<!-- ========================================
=       iPhone Product Card Component       =
========================================= -->
<!-- зміна: створено інтерактивну картку товару iPhone з формою заявки та посиланням на детальну сторінку -->

<div class="iphone-product-card">
  <div class="card product-card-modern h-100 shadow-sm border-0">
    <!-- Клікабельна область картки -->
    <a href="@@detailLink" class="text-decoration-none text-dark card-link">
      <!-- Зображення товару -->
      <div class="card-img-wrapper position-relative overflow-hidden">
        <img
          src="@@src"
          alt="@@alt"
          class="card-img-top product-image"
          loading="lazy"
        />
        <div class="product-badge">
          <span class="badge bg-primary">З США</span>
        </div>
      </div>

      <!-- Інформація про товар -->
      <div class="card-body d-flex flex-column">
        <h5 class="card-title product-title fw-bold">@@title</h5>
        <p class="card-text product-description text-muted small">
          @@description
        </p>

        <!-- Ціна -->
        <div class="product-price mb-3">
          <span class="price-current h5 fw-bold text-primary">@@price ₴</span>
          <span class="price-old text-muted text-decoration-line-through ms-2"
            >@@oldPrice ₴</span
          >
        </div>

        <!-- Статус наявності -->
        <div class="product-status mb-3">
          <span class="badge bg-success-subtle text-success">
            <i class="fas fa-check-circle me-1"></i>В наявності
          </span>
        </div>
      </div>
    </a>

    <!-- Кнопки дій (поза клікабельною областю) -->
    <div class="card-footer bg-transparent border-0 pt-0">
      <div class="d-grid gap-2">
        <a href="@@detailLink" class="btn btn-outline-primary">
          <i class="fas fa-eye me-2"></i>Деталі
        </a>
        <button
          class="btn btn-primary btn-order-now"
          data-bs-toggle="modal"
          data-bs-target="#iphoneOrderModal"
          data-product-title="@@title"
          data-product-price="@@price"
          data-product-image="@@src"
        >
          <i class="fas fa-shopping-cart me-2"></i>Оформити заявку
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ===========================================
=           Модальна форма заявки            =
============================================ -->
<div
  class="modal fade"
  id="iphoneOrderModal"
  tabindex="-1"
  aria-labelledby="iphoneOrderModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content border-0 shadow-lg">
      <!-- Заголовок модального вікна -->
      <div class="modal-header bg-light border-0">
        <h5 class="modal-title fw-bold" id="iphoneOrderModalLabel">
          <i class="fas fa-mobile-alt text-primary me-2"></i>
          Оформити заявку на iPhone
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Закрити"
        ></button>
      </div>

      <!-- Контент модального вікна -->
      <div class="modal-body p-4">
        <div class="row">
          <!-- Інформація про товар -->
          <div class="col-md-5 mb-4">
            <div class="selected-product-info">
              <div class="product-preview text-center mb-3">
                <img
                  id="modalProductImage"
                  src=""
                  alt=""
                  class="img-fluid rounded"
                  style="max-height: 200px"
                />
              </div>
              <h6 class="fw-bold" id="modalProductTitle"></h6>
              <p class="text-muted small mb-2">Оригінальний iPhone з США</p>
              <p class="h5 text-primary fw-bold mb-0">
                <span id="modalProductPrice"></span> ₴
              </p>
            </div>
          </div>

          <!-- Форма замовлення -->
          <div class="col-md-7">
            <form id="iphoneOrderForm" class="needs-validation" novalidate>
              <div class="mb-3">
                <label for="customerName" class="form-label fw-semibold">
                  <i class="fas fa-user text-muted me-1"></i>Ваше ім'я *
                </label>
                <input
                  type="text"
                  class="form-control form-control-lg"
                  id="customerName"
                  placeholder="Введіть ваше ім'я"
                  required
                  minlength="2"
                />
                <div class="invalid-feedback">
                  Будь ласка, введіть ваше ім'я (мінімум 2 символи)
                </div>
              </div>

              <div class="mb-3">
                <label for="customerPhone" class="form-label fw-semibold">
                  <i class="fas fa-phone text-muted me-1"></i>Телефон *
                </label>
                <input
                  type="tel"
                  class="form-control form-control-lg"
                  id="customerPhone"
                  placeholder="+380 XX XXX XX XX"
                  required
                  pattern="^\+380\d{9}$"
                />
                <div class="invalid-feedback">
                  Введіть правильний номер телефону (+380XXXXXXXXX)
                </div>
              </div>

              <div class="mb-3">
                <label for="customerEmail" class="form-label fw-semibold">
                  <i class="fas fa-envelope text-muted me-1"></i>Email
                  (опціонально)
                </label>
                <input
                  type="email"
                  class="form-control form-control-lg"
                  id="customerEmail"
                  placeholder="your@email.com"
                />
                <div class="invalid-feedback">Введіть правильний email</div>
              </div>

              <div class="mb-4">
                <label for="customerMessage" class="form-label fw-semibold">
                  <i class="fas fa-comment text-muted me-1"></i>Коментар
                  (опціонально)
                </label>
                <textarea
                  class="form-control"
                  id="customerMessage"
                  rows="3"
                  placeholder="Додаткові побажання щодо замовлення..."
                ></textarea>
              </div>

              <!-- Скритне поле з інформацією про товар -->
              <input type="hidden" id="selectedProduct" name="product" />
              <input type="hidden" id="selectedPrice" name="price" />

              <!-- Кнопки -->
              <div class="d-grid gap-2">
                <button type="submit" class="btn btn-primary btn-lg">
                  <i class="fas fa-paper-plane me-2"></i>
                  Надіслати заявку
                </button>
                <button
                  type="button"
                  class="btn btn-outline-secondary"
                  data-bs-dismiss="modal"
                >
                  Скасувати
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- =======================================
=           Модальне вікно успіху         =
======================================== -->
<div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow">
      <div class="modal-body text-center p-5">
        <div class="success-icon mb-4">
          <i
            class="fas fa-check-circle text-success"
            style="font-size: 4rem"
          ></i>
        </div>
        <h4 class="fw-bold mb-3">Заявка надіслана!</h4>
        <p class="text-muted mb-4">
          Дякуємо за ваш інтерес до нашої продукції. Наш менеджер зв'яжеться з
          вами протягом 15 хвилин.
        </p>
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">
          Зрозуміло
        </button>
      </div>
    </div>
  </div>
</div>

<style>
  /* ==========================================
=          iPhone Product Card Styles       =
=========================================== */

  .iphone-product-card {
    max-width: 350px;
    margin: 0 auto;
  }

  .product-card-modern {
    transition: all 0.3s ease;
    border-radius: 16px !important;
    overflow: hidden;
  }

  .product-card-modern:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1) !important;
  }

  .card-img-wrapper {
    position: relative;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    padding: 20px;
    border-radius: 16px 16px 0 0;
  }

  .product-image {
    width: 100%;
    height: 250px;
    object-fit: contain;
    transition: transform 0.3s ease;
  }

  .product-card-modern:hover .product-image {
    transform: scale(1.05);
  }

  .product-badge {
    position: absolute;
    top: 15px;
    right: 15px;
    z-index: 10;
  }

  .product-badge .badge {
    font-size: 0.75rem;
    padding: 6px 12px;
    border-radius: 20px;
  }

  .product-title {
    color: #1d1d1f;
    font-size: 1.25rem;
    margin-bottom: 0.5rem;
  }

  .product-description {
    line-height: 1.5;
    margin-bottom: 1rem;
  }

  .price-current {
    color: #007bff !important;
    font-size: 1.5rem;
  }

  .price-old {
    font-size: 1rem;
  }

  .product-status .badge {
    font-size: 0.8rem;
    padding: 8px 12px;
    border-radius: 20px;
  }

  .btn-order-now {
    background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
    border: none;
    border-radius: 12px;
    padding: 12px 24px;
    font-weight: 600;
    font-size: 1rem;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
  }

  .btn-order-now:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 123, 255, 0.4);
    background: linear-gradient(135deg, #0056b3 0%, #004085 100%);
  }

  .btn-order-now:active {
    transform: translateY(0);
  }

  /* Modal Styles */
  .modal-content {
    border-radius: 20px;
  }

  .selected-product-info {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 16px;
    border: 1px solid #e9ecef;
  }

  .form-control-lg {
    border-radius: 12px;
    border: 2px solid #e9ecef;
    padding: 12px 16px;
    transition: all 0.3s ease;
  }

  .form-control-lg:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.1);
  }

  .success-icon {
    animation: successPulse 1s ease-in-out;
  }

  @keyframes successPulse {
    0% {
      transform: scale(0);
      opacity: 0;
    }
    50% {
      transform: scale(1.1);
      opacity: 1;
    }
    100% {
      transform: scale(1);
      opacity: 1;
    }
  }

  /* Responsive */
  @media (max-width: 768px) {
    .iphone-product-card {
      max-width: 100%;
    }

    .modal-lg {
      max-width: 95%;
    }

    .card-img-wrapper {
      padding: 15px;
    }

    .product-image {
      height: 200px;
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // ==========================================
    // iPhone Product Card JavaScript
    // ==========================================

    const orderModal = document.getElementById("iphoneOrderModal");
    const successModal = document.getElementById("successModal");
    const orderForm = document.getElementById("iphoneOrderForm");

    // Обробка відкриття модального вікна
    if (orderModal) {
      orderModal.addEventListener("show.bs.modal", function (event) {
        const button = event.relatedTarget;

        // Отримуємо дані про товар з кнопки
        const productTitle = button.getAttribute("data-product-title");
        const productPrice = button.getAttribute("data-product-price");
        const productImage = button.getAttribute("data-product-image");

        // Заповнюємо модальне вікно даними
        const modalTitle = orderModal.querySelector("#modalProductTitle");
        const modalPrice = orderModal.querySelector("#modalProductPrice");
        const modalImage = orderModal.querySelector("#modalProductImage");
        const hiddenProduct = orderModal.querySelector("#selectedProduct");
        const hiddenPrice = orderModal.querySelector("#selectedPrice");

        if (modalTitle) modalTitle.textContent = productTitle;
        if (modalPrice) modalPrice.textContent = productPrice;
        if (modalImage) {
          modalImage.src = productImage;
          modalImage.alt = productTitle;
        }
        if (hiddenProduct) hiddenProduct.value = productTitle;
        if (hiddenPrice) hiddenPrice.value = productPrice;
      });
    }

    // Маска для телефону
    const phoneInput = document.getElementById("customerPhone");
    if (phoneInput) {
      phoneInput.addEventListener("input", function (e) {
        let value = e.target.value.replace(/\D/g, "");

        if (value.length > 0 && !value.startsWith("380")) {
          if (value.startsWith("0")) {
            value = "380" + value.substring(1);
          } else if (!value.startsWith("380")) {
            value = "380" + value;
          }
        }

        if (value.length > 12) {
          value = value.substring(0, 12);
        }

        let formatted = "+";
        if (value.length > 0) {
          formatted += value.substring(0, 3);
        }
        if (value.length > 3) {
          formatted += " " + value.substring(3, 5);
        }
        if (value.length > 5) {
          formatted += " " + value.substring(5, 8);
        }
        if (value.length > 8) {
          formatted += " " + value.substring(8, 10);
        }
        if (value.length > 10) {
          formatted += " " + value.substring(10, 12);
        }

        e.target.value = formatted;
      });

      // Встановлюємо початкове значення
      if (phoneInput.value === "") {
        phoneInput.value = "+380 ";
      }
    }

    // Обробка відправки форми
    if (orderForm) {
      orderForm.addEventListener("submit", function (e) {
        e.preventDefault();

        // Валідація форми
        if (!orderForm.checkValidity()) {
          e.stopPropagation();
          orderForm.classList.add("was-validated");
          return;
        }

        // Збираємо дані форми
        const formData = {
          product: document.getElementById("selectedProduct").value,
          price: document.getElementById("selectedPrice").value,
          name: document.getElementById("customerName").value,
          phone: document.getElementById("customerPhone").value,
          email: document.getElementById("customerEmail").value,
          message: document.getElementById("customerMessage").value,
          timestamp: new Date().toISOString(),
        };

        // Показуємо індикатор завантаження
        const submitBtn = orderForm.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML =
          '<i class="fas fa-spinner fa-spin me-2"></i>Відправляємо...';
        submitBtn.disabled = true;

        // Імітація відправки (тут може бути реальний fetch до сервера)
        setTimeout(() => {
          console.log("Order submitted:", formData);

          // Закриваємо модальне вікно замовлення
          const orderModalInstance = bootstrap.Modal.getInstance(orderModal);
          orderModalInstance.hide();

          // Показуємо модальне вікно успіху
          const successModalInstance = new bootstrap.Modal(successModal);
          successModalInstance.show();

          // Очищуємо форму
          orderForm.reset();
          orderForm.classList.remove("was-validated");

          // Відновлюємо кнопку
          submitBtn.innerHTML = originalText;
          submitBtn.disabled = false;

          // Встановлюємо початкове значення телефону
          if (phoneInput) {
            phoneInput.value = "+380 ";
          }
        }, 1500);
      });
    }

    // Очищення валідації при зміні полів
    const formInputs = orderForm?.querySelectorAll("input, textarea");
    formInputs?.forEach((input) => {
      input.addEventListener("input", function () {
        if (input.checkValidity()) {
          input.classList.remove("is-invalid");
          input.classList.add("is-valid");
        } else {
          input.classList.remove("is-valid");
          input.classList.add("is-invalid");
        }
      });
    });
  });
</script>
